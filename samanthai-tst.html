<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SamanthAI Chat</title>
  <link rel="icon" href="/favicon.png" type="image/png" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to bottom, #000000 0%, #3b0056 100%);
      color: #e5e5e5;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow-x: hidden;
    }

    header {
      background: rgba(0, 0, 0, 0.6);
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    #menu-btn {
      position: absolute;
      left: 20px;
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
    }

    #menu-btn img {
      width: 28px;
      height: 28px;
      user-select: none;
    }

    header h1 {
      margin: 0;
      font-weight: 600;
      font-size: 1.6rem;
      color: #e5e5e5;
      text-align: center;
      user-select: none;
    }

    /* Side menu styles */
    #side-menu {
      position: fixed;
      top: 0;
      left: -240px;
      width: 240px;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      box-shadow: 3px 0 8px rgba(0, 0, 0, 0.7);
      transition: left 0.3s ease;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      padding: 20px;
      gap: 15px;
    }
    #side-menu.open {
      left: 0;
    }

    #side-menu button {
      background: #a100f2;
      border: none;
      color: white;
      padding: 12px 20px;
      border-radius: 20px;
      cursor: pointer;
      font-weight: 600;
      font-size: 1rem;
      transition: background 0.3s ease;
      user-select: none;
      width: 100%;
    }
    #side-menu button:hover {
      background: #8600cc;
    }

    #chat-window {
      flex: 1;
      padding: 16px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: rgba(0, 0, 0, 0.4);
      transition: margin-left 0.3s ease;
      margin-left: 0;
    }
    /* Shift chat window right when menu is open */
    #chat-window.menu-open {
      margin-left: 240px;
    }

    .message {
      max-width: 85%;
      padding: 12px 18px;
      border-radius: 20px;
      line-height: 1.4;
      word-wrap: break-word;
      word-break: break-word;
    }

    .message.user {
      align-self: flex-end;
      background: #a100f2;
      color: white;
      border-bottom-right-radius: 4px;
    }

    .message.bot {
      align-self: flex-start;
      background: #370066;
      color: #ddd;
      border-bottom-left-radius: 4px;
    }

    #input-area {
      background: rgba(0, 0, 0, 0.6);
      padding: 12px 16px;
      display: flex;
      gap: 10px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      flex-wrap: wrap;
      align-items: center;
    }

    #user-input {
      flex: 1;
      padding: 12px 16px;
      font-size: 1rem;
      border: none;
      border-radius: 30px;
      outline: none;
      font-family: 'Poppins', sans-serif;
      min-width: 0;
      color: #e5e5e5;
      background: rgba(255 255 255 / 0.1);
    }

    #send-btn,
    #keyboard-toggle {
      padding: 12px;
      border: none;
      border-radius: 30px;
      color: white;
      cursor: pointer;
      user-select: none;
      background: #a100f2;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 48px;
      height: 48px;
      transition: background 0.3s ease;
    }

    #send-btn:hover {
      background: #8600cc;
    }

    #keyboard-toggle {
      background: #444;
    }

    #keyboard-toggle:hover {
      background: #666;
    }

    #keyboard {
      display: none;
      flex-wrap: wrap;
      gap: 6px;
      padding: 12px;
      background: rgba(0, 0, 0, 0.6);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    #keyboard button {
      flex: 1 0 9%;
      min-width: 36px;
      padding: 10px;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
      background: #2a003f;
      color: white;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      transition: background 0.3s ease;
    }

    #keyboard button:hover {
      background: #3d005a;
    }

    /* Make spacebar bigger */
    #keyboard button.space {
      flex: 1 0 40%;
      border-radius: 20px;
      font-weight: 600;
      font-size: 1.1rem;
      background: #3d005a;
    }

    #keyboard button.space:hover {
      background: #54007a;
    }

    @media (max-width: 600px) {
      header h1 {
        font-size: 1.3rem;
      }

      #chat-window {
        padding: 12px;
      }

      #input-area {
        flex-direction: column;
        gap: 8px;
      }

      #send-btn,
      #keyboard-toggle {
        width: 48px;
        height: 48px;
      }

      .message {
        max-width: 100%;
      }

      #keyboard button {
        flex: 1 0 12%;
        font-size: 0.9rem;
      }

      #keyboard button.space {
        flex: 1 0 60%;
      }
    }
  </style>
</head>
<body>

  <header>
    <button id="menu-btn" aria-label="Toggle menu" title="Toggle menu">
      <img id="menu-icon" src="https://img.icons8.com/ios-filled/28/ffffff/menu--v1.png" alt="Open menu" />
    </button>
    <h1>SamanthAI</h1>
  </header>

  <nav id="side-menu" aria-label="Side menu">
    <button id="new-chat-btn" aria-label="Start new chat" title="New Chat">New Chat</button>
    <button id="clear-chat-btn" aria-label="Clear chat" title="Clear chat">Clear Chat</button>
  </nav>

  <div id="chat-window" role="log" aria-live="polite">
    <!-- Chat messages appear here -->
  </div>

  <div id="input-area">
    <input id="user-input" type="text" placeholder="Type your message..." autocomplete="off" aria-label="Type your message" />
    <button id="send-btn" aria-label="Send message" title="Send">
      <img src="https://img.icons8.com/ios-filled/24/ffffff/filled-sent.png" alt="Send" />
    </button>
    <button id="keyboard-toggle" aria-label="Toggle keyboard" title="Toggle keyboard">
      <img src="https://img.icons8.com/ios-filled/24/ffffff/keyboard.png" alt="Keyboard" />
    </button>
  </div>

  <div id="keyboard"></div>

  <script>
    const chat = document.getElementById('chat-window');
    const input = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const clearChatBtn = document.getElementById('clear-chat-btn');
    const newChatBtn = document.getElementById('new-chat-btn');
    const menuBtn = document.getElementById('menu-btn');
    const sideMenu = document.getElementById('side-menu');
    const menuIcon = document.getElementById('menu-icon');
    const keyboardToggle = document.getElementById('keyboard-toggle');
    const keyboard = document.getElementById('keyboard');

    // Load messages from localStorage on startup
    function loadMessages() {
      const saved = localStorage.getItem('chatMessages');
      if (!saved) return;
      const messages = JSON.parse(saved);
      messages.forEach(({ sender, text, isButtonGroup }) => {
        if (isButtonGroup) {
          appendButtonGroup();
        } else {
          appendMessage(sender, text);
        }
      });
      scrollToBottom();
    }

    // Save messages to localStorage
    function saveMessages() {
      const msgs = [];
      chat.querySelectorAll('.message, .button-group').forEach(node => {
        if (node.classList.contains('message')) {
          msgs.push({
            sender: node.classList.contains('user') ? 'user' : 'bot',
            text: node.textContent,
            isButtonGroup: false
          });
        } else if (node.classList.contains('button-group')) {
          msgs.push({ isButtonGroup: true });
        }
      });
      localStorage.setItem('chatMessages', JSON.stringify(msgs));
    }

    // Append a message element
    function appendMessage(sender, text) {
      const div = document.createElement('div');
      div.className = 'message ' + (sender === 'user' ? 'user' : 'bot');
      div.textContent = text;
      chat.appendChild(div);
    }

    // Append button group for notification prompt
    function appendButtonGroup() {
      const btnContainer = document.createElement('div');
      btnContainer.className = 'button-group';
      btnContainer.style.marginTop = '10px';
      btnContainer.style.display = 'flex';
      btnContainer.style.gap = '10px';

      const notifyBtn = document.createElement('button');
      notifyBtn.textContent = "Notify Me";
      notifyBtn.style = `
        padding: 8px 15px;
        border-radius: 20px;
        background: #a100f2;
        color: white;
        border: none;
        cursor: pointer;
        font-weight: 600;
        flex: 1;
      `;
      notifyBtn.onclick = () => {
        if (Notification.permission === "granted") {
          showNotification();
        } else if (Notification.permission !== "denied") {
          Notification.requestPermission().then(permission => {
            if (permission === "granted") {
              showNotification();
            } else {
              alert("Notification permission denied.");
            }
          });
        } else {
          alert("Please enable notifications in your browser settings.");
        }
        notifyBtn.disabled = true;
        noThanksBtn.disabled = true;
      };

      const noThanksBtn = document.createElement('button');
      noThanksBtn.textContent = "No Thanks";
      noThanksBtn.style = `
        padding: 8px 15px;
        border-radius: 20px;
        background: #555;
        color: white;
        border: none;
        cursor: pointer;
        font-weight: 600;
        flex: 1;
      `;
      noThanksBtn.onclick = () => {
        notifyBtn.disabled = true;
        noThanksBtn.disabled = true;
      };

      btnContainer.appendChild(notifyBtn);
      btnContainer.appendChild(noThanksBtn);
      chat.appendChild(btnContainer);
    }

    // Scroll chat to bottom
    function scrollToBottom() {
      chat.scrollTop = chat.scrollHeight;
    }

    // Simulate bot reply with a delay
    function botReply(userText) {
      appendMessage('bot', 'Thinking...');
      scrollToBottom();

      setTimeout(() => {
        // Remove "Thinking..." placeholder
        const lastBotMsg = [...chat.querySelectorAll('.message.bot')].pop();
        if (lastBotMsg && lastBotMsg.textContent === 'Thinking...') {
          lastBotMsg.remove();
        }
        // Basic echo response - replace this with your bot logic
        appendMessage('bot', `You said: ${userText}`);

        // Example: show notification prompt after first bot response
        if (!localStorage.getItem('notifiedPromptShown')) {
          appendButtonGroup();
          localStorage.setItem('notifiedPromptShown', 'true');
        }

        saveMessages();
        scrollToBottom();
      }, 1200);
    }

    // Send message handler
    function sendMessage() {
      const text = input.value.trim();
      if (!text) return;
      appendMessage('user', text);
      input.value = '';
      saveMessages();
      scrollToBottom();
      botReply(text);
    }

    // Clear chat handler
    clearChatBtn.addEventListener('click', () => {
      if (confirm("Are you sure you want to clear the chat?")) {
        localStorage.removeItem('chatMessages');
        localStorage.removeItem('notifiedPromptShown');
        chat.innerHTML = '';
      }
    });

    // New chat handler - clears chat and localStorage
    newChatBtn.addEventListener('click', () => {
      if (confirm("Start a new chat? This will clear current messages.")) {
        localStorage.removeItem('chatMessages');
        localStorage.removeItem('notifiedPromptShown');
        chat.innerHTML = '';
        input.value = '';
        input.focus();
      }
    });

    // Toggle side menu
    menuBtn.addEventListener('click', () => {
      const isOpen = sideMenu.classList.toggle('open');
      document.getElementById('chat-window').classList.toggle('menu-open', isOpen);
      if (isOpen) {
        menuIcon.src = 'https://img.icons8.com/ios-filled/28/ffffff/multiply.png'; // cross icon
        menuIcon.alt = 'Close menu';
      } else {
        menuIcon.src = 'https://img.icons8.com/ios-filled/28/ffffff/menu--v1.png'; // menu icon
        menuIcon.alt = 'Open menu';
      }
    });

    // Close menu if clicking outside
    document.addEventListener('click', e => {
      const isClickInsideMenu = sideMenu.contains(e.target);
      const isClickOnMenuBtn = menuBtn.contains(e.target);
      if (sideMenu.classList.contains('open') && !isClickInsideMenu && !isClickOnMenuBtn) {
        sideMenu.classList.remove('open');
        document.getElementById('chat-window').classList.remove('menu-open');
        menuIcon.src = 'https://img.icons8.com/ios-filled/28/ffffff/menu--v1.png';
        menuIcon.alt = 'Open menu';
      }
    });

    keyboardToggle.addEventListener('click', () => {
      if (keyboard.style.display === 'flex') {
        keyboard.style.display = 'none';
      } else {
        keyboard.style.display = 'flex';
        input.focus();
      }
    });

    // Build on-screen keyboard keys
    const keys = [
      'Q','W','E','R','T','Y','U','I','O','P',
      'A','S','D','F','G','H','J','K','L',
      'Z','X','C','V','B','N','M',
      'Backspace','Space','Enter'
    ];

    keys.forEach(key => {
      const btn = document.createElement('button');
      btn.textContent = key === 'Space' ? ' ' : (key === 'Backspace' ? '⌫' : (key === 'Enter' ? '↵' : key));
      btn.className = key === 'Space' ? 'space' : '';
      btn.addEventListener('click', () => {
        if (key === 'Backspace') {
          input.value = input.value.slice(0, -1);
        } else if (key === 'Enter') {
          sendMessage();
        } else if (key === 'Space') {
          input.value += ' ';
        } else {
          input.value += key;
        }
        input.focus();
      });
      keyboard.appendChild(btn);
    });

    loadMessages();
  </script>
</body>
</html>
